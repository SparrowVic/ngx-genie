<div class="viewport-toolbar">
  <div class="view-switcher">
    <button [class.active]="viewMode() === 'tree'" (click)="setMode('tree')">TREE</button>
    <button [class.active]="viewMode() === 'org'" (click)="setMode('org')">ORG</button>
    <button [class.active]="viewMode() === 'matrix'" (click)="setMode('matrix')" class="special-btn">MATRIX</button>
    <button [class.active]="viewMode() === 'constellation'" (click)="setMode('constellation')" class="epic-btn">CONST
    </button>
    <button [class.active]="viewMode() === 'diagnostics'" (click)="setMode('diagnostics')" class="diag-btn">⚠️ DIAG
    </button>
  </div>

  <div class="toolbar-right">
    @if (!isStaticView()) {
      <div class="epic-zoom-control">
        <span class="zoom-label">ZOOM</span>
        <input type="range" min="0.1" max="5.0" step="0.1"
               [ngModel]="visualScale()" (ngModelChange)="visualScale.set($event)">
        <span class="zoom-val">{{ visualScale() * 100 | number:'1.0-0' }}%</span>
      </div>
    }

    @if (viewMode() === 'tree' || viewMode() === 'org') {
      <div class="zoom-group" title="UI Text Scale">
        <button (click)="zoomOutUi()">A-</button>
        <span>{{ uiScale() * 100 | number:'1.0-0' }}%</span>
        <button (click)="zoomInUi()">A+</button>
      </div>
    }
  </div>
</div>


<div
  #viewportContent
  class="viewport-content"
  [class.scrollable-mode]="isStaticView()"
  [class.pan-zoom-mode]="!isStaticView()"
  [style.--ui-scale]="uiScale()"
  (wheel)="onWheel($event)"
  (mousedown)="onMouseDown($event)"
>
  @switch (viewMode()) {
    @case ('tree') {
      <lib-tree-view
        class="full-size"
        [tree]="tree()"
        [toggleNode]="toggleNode()"
        [filterState]="filterState()"
        [getProvidersForNode]="getProvidersForNode()"
        [selectDependency]="selectDependency()"
        [isNodeExpanded]="checkExpandedFn()"
        [selectNode]="selectNode()"
      />
    }
    @case ('matrix') {
      <lib-matrix-view
        class="full-size hidden-overflow"
        [tree]="tree()"
        [filterState]="filterState()"
        [getProvidersForNode]="getProvidersForNode()"
        [selectService]="selectDependency()"
      />
    }
    @case ('org') {
      <lib-org-chart-view
        [tree]="tree()"
        [toggleNode]="toggleNode()"
        [filterState]="filterState()"
        [getProvidersForNode]="getProvidersForNode()"
        [selectService]="selectDependency()"
        [isNodeExpanded]="checkExpandedFn()"
        [transformStyle]="transformStyle()"
        [selectNode]="selectNode()"
      />
    }
    @case ('constellation') {
      <lib-constellation-view
        [tree]="tree()"
        [filterState]="filterState()"
        [getProvidersForNode]="getProvidersForNode()"
        [selectService]="selectDependency()"
        [transformStyle]="transformStyle()"
      />
    }
    @case ('diagnostics') {
      <lib-diagnostics-view [selectService]="selectDependency()"/>
    }
  }
</div>
